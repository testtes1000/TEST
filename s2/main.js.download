function SwipeBlur(wrapper) {
  var $wrapper = $(wrapper);
  var $slider = $wrapper.find('.slider');
  var $handler = $wrapper.find('.handler');
  var $progress = $wrapper.find('.progress');
  var $image = $wrapper.find('.image img');
  var initBlur = parseInt($image.css('filter').replace(/^\D+/g, ''));
  var blurringSteps = 4;
  var blurringStep = 1;
  var progress = 0;
  var drugging = false;
  var mouseX = 0;

  _init();

  function _init() {
    console.log('init');

    _adjustHandler(progress);

    $(document).on('mousedown touchstart', _handleStart);
    $(document).on('mousemove touchmove', _handleMove);
    $(document).on('mouseup touchend', _handleEnd);
  }

  function _handleStart(e) {
    if ($wrapper.is(".success")) {
      window.location.href = $wrapper.attr('data-link');
      return;
    }
    if ($(e.target).is($handler)) {
      $handler.removeClass('animated');
      $wrapper.addClass('drugged');
      drugging = true;
      mouseX = e.clientX || e.touches[0].clientX;
    }
  }

  function _handleEnd(e) {
    if (!drugging) return;
    drugging = false;
    if (progress > (100 / blurringSteps) * (blurringSteps - 1)) {
      progress = 100;
      $handler.addClass('animated');
      _adjustHandler(progress);
      $wrapper.addClass('success');
    }
  }

  function _handleMove(e) {
    if (!drugging) return;

    var x = e.clientX || e.touches[0].clientX;
    var delta = x - mouseX;
    mouseX = x;
    progress = progress + (delta / $slider.width()) * 100;
    if (progress < 0) progress = 0;
    if (progress > 100) progress = 100;
    _adjustHandler(progress);
  }

  function _adjustBlur(progress) {
    var step = Math.floor(progress / (100 / blurringSteps)) + 1;
    if (step > blurringSteps) step = blurringSteps;
    if (step !== blurringStep) {
      blurringStep = step;
      var blur = initBlur - (initBlur / blurringSteps) * blurringStep;
      $image.css('filter', 'blur(' + blur + 'px)');
    }
  }

  function _adjustHandler(progress) {
    $handler.css('left', progress + '%');
    _adjustProgress(progress);
    _adjustBlur(progress);
  }

  function _adjustProgress(progress) {
    $progress.css('width', progress + '%');
  }

  function _ieVersion() {

    var ua = window.navigator.userAgent;
    var msie = ua.indexOf("MSIE ");

    if (msie > 0 || !!navigator.userAgent.match(/Trident.*rv\:11\./))  // If Internet Explorer, return version number
    {
      alert(parseInt(ua.substring(msie + 5, ua.indexOf(".", msie))));
    }
    else  // If another browser, return 0
    {
      alert('otherbrowser');
    }

    return false;
  }
}

new SwipeBlur('.js-swipe-blur');